# SmartVoice 技术实施路线图

**版本:** 2.0
**日期:** 2026-01-22
**状态:** 已确认

---

## 📋 路线图概述

基于 SmartVoice 产品路线图和技术架构设计,本文档规划技术实施的详细计划、开发规范和风险应对策略。

**目标:**
- MVP(Alpha) - 3个月(12周) - 核心功能验证
- Beta - 1个月(4周) - 功能完善和测试
- V1.0 - 2个月(8周) - 商业化准备

---

## 🎯 技术里程碑

### MVP阶段(第1-12周)

#### 第1-2周:基础设施搭建

**目标:完成开发环境和基础架构**

| 任务 | 负责人 | 预计工时 | 产出 |
|------|--------|---------|------|
| 项目初始化 | 全栈1 | 4h | Git仓库、Monorepo结构(前后端) |
| 前端脚手架 | 全栈1 | 8h | React+Vite+TypeScript项目 |
| 后端脚手架 | 全栈2 | 8h | Node.js+Express+TypeScript项目 |
| 数据库设计 | 全栈2 | 8h | PostgreSQL表结构脚本 |
| Docker环境 | 全栈1 | 8h | docker-compose.yml(7个服务) |
| MinIO部署 | 全栈1 | 4h | MinIO容器、S3 SDK配置 |
| Coqui TTS部署 | 全栈2 | 8h | TTS Server容器、GPU配置 |
| 阿里云账号配置 | 全栈1 | 4h | ECS(GPU)、OSS Bucket(备份) |
| 代码规范配置 | 全栈2 | 4h | ESLint、Prettier、Husky |
| **小计** | | **56h** | 开发环境就绪 |

**关键决策:**
- 使用Monorepo管理前后端代码(pnpm workspace)
- PostgreSQL使用Docker本地开发
- MinIO自部署,S3 SDK兼容,可切换到OSS
- Coqui TTS需要GPU,Docker Compose配置GPU支持
- 代码规范:Airbnb + 自定义规则

---

#### 第3-4周:用户模块 + 项目管理

**目标:用户可以注册登录并上传文件**

| 任务 | 负责人 | 预计工时 | 产出 |
|------|--------|---------|------|
| 用户注册登录API | 全栈2 | 12h | POST /auth/register, /auth/login |
| JWT认证中间件 | 全栈2 | 4h | JWT验证、用户鉴权 |
| 前端登录页面 | 全栈1 | 8h | 注册、登录表单 |
| 文件上传API | 全栈2 | 8h | POST /projects(multipart) |
| MinIO集成 | 全栈2 | 8h | MinIO SDK,流式上传,S3兼容 |
| 前端上传组件 | 全栈1 | 12h | 文件拖拽、进度条 |
| 项目列表页 | 全栈1 | 8h | 项目列表、详情页 |
| **小计** | | **60h** | 用户可上传项目 |

**验收标准:**
- 用户可以注册、登录(邮箱+密码)
- JWT Token认证生效
- 用户可以上传txt文件(≤10MB)
- 文件成功上传到MinIO(后续可一键切换到OSS)

---

#### 第5-6周:文本解析 + 角色识别

**目标:自动识别章节和角色**

| 任务 | 负责人 | 预计工时 | 产出 |
|------|--------|---------|------|
| 文本解析引擎 | 全栈2 | 16h | 章节识别、段落分割 |
| Bull任务队列 | 全栈2 | 8h | Redis+Bull集成 |
| Worker进程 | 全栈2 | 8h | 异步解析Worker |
| Deepseek API集成 | 全栈2 | 12h | 角色识别API调用,Adapter接口 |
| WebSocket推送 | 全栈1 | 8h | Socket.io进度推送 |
| 前端实时进度 | 全栈1 | 8h | WebSocket监听、进度条 |
| 角色列表页 | 全栈1 | 8h | 角色展示、音色选择 |
| **小计** | | **68h** | 自动识别角色 |

**验收标准:**
- 系统自动识别章节(准确率>80%)
- 调用Deepseek识别角色(准确率>85%,成本¥0.3/项目)
- 前端实时显示解析进度
- 角色列表展示名称、性别、对话数

---

#### 第7-9周:TTS生成核心功能

**目标:批量生成多角色音频**

| 任务 | 负责人 | 预计工时 | 产出 |
|------|--------|---------|------|
| Coqui TTS集成 | 全栈2 | 16h | Coqui TTS API调用,Adapter接口 |
| TTS Fallback机制 | 全栈2 | 8h | 自动切换百度TTS备用方案 |
| 音频缓存策略 | 全栈2 | 8h | Redis缓存音频URL |
| 音频拼接 | 全栈2 | 12h | fluent-ffmpeg拼接音频 |
| TTS Worker | 全栈2 | 16h | 批量生成、并发控制 |
| 音色预览API | 全栈2 | 8h | POST /characters/:id/preview |
| 生成任务API | 全栈2 | 8h | POST /projects/:id/generate |
| 前端音色配置 | 全栈1 | 12h | 音色选择、参数调整 |
| 前端生成页面 | 全栈1 | 12h | 章节选择、生成按钮、进度 |
| 音频播放器 | 全栈1 | 8h | 在线播放、进度控制 |
| **小计** | | **108h** | 可生成音频 |

**验收标准:**
- 用户可预览音色(3秒内返回,Coqui TTS)
- 批量生成章节音频(10万字<2分钟)
- Coqui TTS失败时自动切换百度TTS
- 音频拼接无明显停顿
- 在线播放流畅

---

#### 第10-12周:音频管理 + MVP收尾

**目标:完整的音频导出和用户体验**

| 任务 | 负责人 | 预计工时 | 产出 |
|------|--------|---------|------|
| 音频列表API | 全栈2 | 4h | GET /projects/:id/audios |
| 下载链接生成 | 全栈2 | 4h | MinIO签名URL |
| 音频下载功能 | 全栈1 | 4h | 前端下载按钮 |
| Storage Adapter完善 | 全栈2 | 8h | 支持MinIO/OSS切换 |
| 错误处理 | 全栈2 | 8h | 统一错误处理、重试机制 |
| 日志系统 | 全栈2 | 4h | Winston日志 |
| 前端优化 | 全栈1 | 12h | Loading、Toast、错误提示 |
| 部署到阿里云 | 全栈1 | 8h | Docker部署、Nginx配置、GPU配置 |
| Alpha测试 | 全员 | 16h | 内部测试、Bug修复 |
| **小计** | | **68h** | MVP就绪 |

**验收标准:**
- 用户可下载生成的音频(从MinIO)
- Storage Adapter可配置切换到OSS
- 错误有友好提示
- Alpha版本可供内部测试
- 部署到生产环境(阿里云ECS GPU)

**MVP总计:360人时**(56h + 60h + 68h + 108h + 68h)(vs 原324人时,因增加MinIO/Coqui TTS部署)

---

### Beta阶段(第13-16周)

#### 目标:功能完善、性能优化、测试

| 任务 | 预计工时 | 产出 |
|------|---------|------|
| **功能完善** | | |
| 音色库扩展(10+音色) | 8h | 音色列表页 |
| 项目编辑功能 | 12h | 修改章节、角色配置 |
| 音频删除功能 | 4h | 删除音频、释放存储 |
| | | |
| **性能优化** | | |
| 数据库索引优化 | 8h | 查询性能提升 |
| API响应优化 | 8h | Gzip压缩、缓存 |
| 前端代码分割 | 8h | 减少首屏加载时间 |
| | | |
| **测试和修复** | | |
| 单元测试(后端) | 16h | 核心模块测试覆盖 |
| E2E测试(前端) | 16h | Playwright测试 |
| Bug修复 | 24h | 测试发现的Bug |
| | | |
| **小计** | **104h** | Beta版本 |

**验收标准:**
- 核心功能测试覆盖率>70%
- API响应时间P95<500ms
- 前端首屏加载<3秒
- 累计Bug<10个

---

### V1.0阶段(第17-24周)

#### 目标:商业化准备、用户付费、监控运维

| 任务 | 预计工时 | 产出 |
|------|---------|------|
| **商业化功能** | | |
| 会员订阅系统 | 24h | 免费/付费套餐 |
| 支付集成(微信/支付宝) | 16h | 支付API集成 |
| 配额管理 | 8h | 项目额度限制 |
| | | |
| **运维和监控** | | |
| Sentry错误追踪 | 4h | 错误监控 |
| 业务指标看板 | 16h | 用户数、项目数、成本 |
| 日志聚合 | 8h | ELK/Loki |
| 数据库备份 | 4h | 自动备份脚本 |
| | | |
| **文档和运营** | | |
| 用户文档 | 16h | 使用指南、FAQ |
| 管理后台 | 24h | 用户管理、数据统计 |
| | | |
| **小计** | **120h** | V1.0发布 |

**验收标准:**
- 支付功能正常,可购买会员
- 错误监控接入Sentry
- 数据库自动备份
- 用户文档完善

---

## 👥 团队分工

### 人员角色

**全栈1(前端偏向):**
- 前端页面开发
- 前端组件库封装
- 用户体验优化

**全栈2(后端偏向):**
- 后端API开发
- 数据库设计
- 第三方服务集成(TTS、GPT、OSS)
- Worker异步任务

**共同负责:**
- 技术方案讨论
- Code Review
- 测试和Bug修复
- 部署和运维

---

## 📏 开发规范

### Git工作流

**分支策略:**
```
main (生产环境)
  ↑
dev (开发环境)
  ↑
feature/xxx (功能分支)
```

**提交规范(Conventional Commits):**
```
feat: 新功能
fix: Bug修复
docs: 文档更新
style: 代码格式
refactor: 重构
test: 测试
chore: 构建/工具链
```

**Pull Request流程:**
1. 创建feature分支
2. 开发完成后提交PR到dev
3. Code Review(至少1人)
4. 通过CI测试后合并
5. 定期将dev合并到main发布

---

### 代码规范

**前端(React + TypeScript):**
- ESLint: Airbnb规则 + React Hooks规则
- Prettier: 单引号、无分号、2空格
- 命名: 组件PascalCase、函数camelCase、常量UPPER_CASE
- 文件结构:
  ```
  src/
  ├── components/    # 通用组件
  ├── pages/         # 页面组件
  ├── services/      # API调用
  ├── stores/        # Zustand状态管理
  ├── utils/         # 工具函数
  └── types/         # TypeScript类型
  ```

**后端(Node.js + Express):**
- ESLint: Airbnb规则
- 命名: 函数camelCase、类PascalCase、常量UPPER_CASE
- 文件结构:
  ```
  src/
  ├── controllers/   # 控制器(处理请求)
  ├── services/      # 业务逻辑
  ├── models/        # Prisma模型
  ├── middlewares/   # 中间件(认证、限流)
  ├── utils/         # 工具函数
  ├── workers/       # Worker进程
  └── config/        # 配置文件
  ```

---

### 测试策略

**单元测试:**
- 前端:Vitest,覆盖工具函数和业务逻辑
- 后端:Jest,覆盖Service层和Controller层
- 目标覆盖率:>70%

**E2E测试(Beta阶段):**
- Playwright测试核心用户流程
- 测试用例:注册→上传→生成→下载

**测试金字塔:**
```
       /\
      /E2E\     (少量关键流程)
     /──────\
    /集成测试\   (API测试)
   /──────────\
  /  单元测试  \  (大量函数测试)
 /──────────────\
```

---

### CI/CD流程

**GitHub Actions:**
```yaml
on: [push, pull_request]

jobs:
  lint:
    - 运行ESLint检查
  test:
    - 运行单元测试
  build:
    - 构建前端(Vite)
    - 构建后端(TypeScript编译)
  deploy:
    - (仅main分支)部署到阿里云
```

**部署流程:**
1. 本地开发 → Git Push
2. GitHub Actions自动构建和测试
3. 测试通过后,手动触发部署
4. SSH到阿里云ECS,拉取镜像,重启服务

---

## ⚠️ 技术风险和应对

### 风险 1: 角色识别准确率不达标

**风险描述:** Deepseek识别准确率<85%,用户需大量手动调整

**影响:** 核心卖点受损,用户体验差

**应对方案:**
1. **Prompt优化** - 迭代优化Prompt,提升准确率
2. **Few-shot Learning** - 提供示例数据辅助识别
3. **多模型备选** - Deepseek失败自动切换Qwen/OpenAI
4. **人工审核** - 允许用户手动修正,系统学习
5. **降级方案** - 提供手动模式,用户自行标注角色

**责任人:** 全栈2

**监控指标:** 角色识别准确率(目标>85%)

---

### 风险 2: TTS成本失控

**风险描述:** 用户大量生成,TTS成本超预算

**影响:** 烧钱速度过快,商业模式不可持续

**应对方案:**
1. **自部署Coqui TTS** - 边际成本¥0,仅GPU固定成本¥2,160/年
2. **Redis缓存** - 相同文本+音色不重复生成(节省30-50%)
3. **用户配额限制** - 免费用户每月1个项目
4. **用户付费** - ¥10-50/项目生成,成本转嫁
5. **自动降级** - Coqui TTS失败时使用百度TTS(按需付费)

**责任人:** 全栈2

**监控指标:** 单用户TTS成本(目标<¥5/项目,主要是GPU摊销)

---

### 风险 2.1: Coqui TTS音质不达标

**风险描述:** Coqui TTS音质不如商业API,用户不满意

**影响:** 用户体验差,退单率高

**应对方案:**
1. **预训练模型测试** - MVP前充分测试,确保音质≥⭐⭐⭐⭐
2. **自动切换** - 高质量项目自动切换百度TTS
3. **用户可选音质档位** - 普通(Coqui免费)/高清(百度付费)
4. **长期优化** - 模型微调,提升音质

**责任人:** 全栈2

**监控指标:** 用户满意度,退单率,音质评分

---

### 风险 3: 开发周期延误

**风险描述:** 3个月MVP周期紧张,可能延期

**影响:** 产品上线时间延后,竞争劣势

**应对方案:**
1. **严格P0范围** - 砍掉非核心功能(如第三方登录、邮件通知)
2. **AI辅助开发** - 使用GitHub Copilot、Cursor加速
3. **复用开源组件** - 音频播放器、文件上传组件使用现成库
4. **预留缓冲时间** - 总计480人时,预留156人时(32%)缓冲

**责任人:** 全员

**监控指标:** 每周实际进度 vs 计划进度

---

### 风险 4: 第三方API稳定性

**风险描述:** Deepseek API、百度TTS可能不稳定或限流

**影响:** 任务失败率高,用户体验差

**应对方案:**
1. **多厂商备选** - Deepseek失败自动切换Qwen/OpenAI
2. **Adapter Pattern** - 统一接口,一行配置切换服务商
3. **重试机制** - API调用失败自动重试3次
4. **降级方案** - TTS失败时通知用户,提供手动重试
5. **监控告警** - API成功率<95%时告警

**责任人:** 全栈2

**监控指标:** TTS/NLP API成功率(目标>95%)

---

### 风险 5: GPU成本超预算

**风险描述:** GPU服务器成本超出预期

**影响:** 固定成本增加,商业模式受影响

**应对方案:**
1. **按需实例** - 仅高峰期启动GPU(按小时计费)
2. **抢占式实例** - 使用抢占式实例(便宜60%)
3. **模型优化** - 减少推理时间,降低GPU使用率
4. **队列限流** - 控制并发任务数
5. **监控GPU利用率** - 及时发现浪费

**责任人:** 全栈2

**监控指标:** GPU利用率,单项目生成时间,GPU成本/项目

---

### 风险 6: MinIO单点故障

**风险描述:** MinIO故障导致文件丢失或不可用

**影响:** 用户文件丢失,服务不可用

**应对方案:**
1. **定期备份到OSS** - 每天自动备份到阿里云OSS
2. **数据库记录元数据** - 可恢复文件列表
3. **健康检查** - MinIO健康检查,故障自动告警
4. **成长期切换OSS** - 用户>5000时切换到OSS主存储

**责任人:** 全栈1

**监控指标:** MinIO健康检查,备份成功率,存储可用性

---

## 📊 技术指标监控

### 性能指标

| 指标 | MVP目标 | Beta目标 | V1.0目标 |
|------|---------|----------|----------|
| API响应时间(P95) | <1s | <500ms | <300ms |
| 文本解析速度 | 10万字/30秒 | 10万字/20秒 | 10万字/10秒 |
| 音频生成速度 | 1分钟/万字 | 30秒/万字 | 20秒/万字 |
| 前端首屏加载 | <5s | <3s | <2s |
| 系统可用性 | >99% | >99.5% | >99.9% |
| 角色识别准确率 | >85% | >90% | >95% |

### 业务指标

| 指标 | MVP目标 | Beta目标 | V1.0目标 |
|------|---------|----------|----------|
| 注册用户 | 50 | 500 | 5,000 |
| 日活用户 | 10 | 100 | 1,000 |
| 项目创建数 | 30 | 300 | 3,000 |
| TTS任务成功率 | >90% | >95% | >99% |

---

## 🔗 相关文档

- [技术总体设计](overall-design.md)
- [技术栈选型](tech-stack.md)
- [第三方服务评估](third-party-services.md)
- [系统架构设计](system-architecture.md)
- [API 设计](api-design.md)

---

## 📝 更新历史

| 版本 | 日期 | 变更说明 | 作者 |
|------|------|----------|------|
| 1.0  | 2026-01-22 | 初始版本,完成技术实施路线图(纯云服务方案) | SmartVoice 团队 |
| 2.0  | 2026-01-22 | 重大更新:添加MinIO/Coqui TTS部署任务,更新风险评估,MVP工时360h | SmartVoice 团队 |

---

**总结:**
- MVP阶段360人时(vs 原324人时,增加36h用于MinIO/Coqui TTS部署和Adapter开发)
- Beta阶段104人时,V1.0阶段120人时,总计584人时
- 基于2人兼职团队(每周40人时),预计MVP 9周,Beta 2.5周,V1.0 3周,总计约15周(3.75个月)
- **自部署方案增加前期开发时间,但长期节省67%成本** ✅
